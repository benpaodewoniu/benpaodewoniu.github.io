<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"benpaodewoniu.github.io","root":"/","scheme":"Pisces","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="作为网络连接的基础库，必须要学一下。">
<meta property="og:type" content="article">
<meta property="og:title" content="OkHttp | 入门 快速开始">
<meta property="og:url" content="http://benpaodewoniu.github.io/2020/07/16/java5/index.html">
<meta property="og:site_name" content="犀牛的博客">
<meta property="og:description" content="作为网络连接的基础库，必须要学一下。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-07-16T15:32:02.000Z">
<meta property="article:modified_time" content="2020-10-08T09:07:36.000Z">
<meta property="article:author" content="犀牛">
<meta property="article:tag" content="OkHttp">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://benpaodewoniu.github.io/2020/07/16/java5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true
  };
</script>

  <title>OkHttp | 入门 快速开始 | 犀牛的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">犀牛的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">姑苏城外一茅屋，万树梅花月满天</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-help">

    <a href="/help/" rel="section"><i class="fa fa-fw fa-question"></i>指引</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-invest">

    <a href="/invest/" rel="section"><i class="fa fa-fw fa-book"></i>投资</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-fw fa-link"></i>友链</a>

  </li>
        <li class="menu-item menu-item-books">

    <a href="/books/" rel="section"><i class="fa fa-fw fa-book"></i>书籍</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-fw fa-sitemap"></i>地图</a>

  </li>
        <li class="menu-item menu-item-problem">

    <a href="/problem/" rel="section"><i class="fa fa-fw fa-question"></i>问前需看</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://benpaodewoniu.github.io/2020/07/16/java5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon/icon.png">
      <meta itemprop="name" content="犀牛">
      <meta itemprop="description" content="求职web3工作，欢迎联系 xiniublog@163.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="犀牛的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          OkHttp | 入门 快速开始
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-16 23:32:02" itemprop="dateCreated datePublished" datetime="2020-07-16T23:32:02+08:00">2020-07-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-08 17:07:36" itemprop="dateModified" datetime="2020-10-08T17:07:36+08:00">2020-10-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">第三方库</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/com-squareup/" itemprop="url" rel="index"><span itemprop="name">com.squareup</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/com-squareup/OkHttp/" itemprop="url" rel="index"><span itemprop="name">OkHttp</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/07/16/java5/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/07/16/java5/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>作为网络连接的基础库，必须要学一下。</p>
<a id="more"></a>

<br/>

<h1 id="OkHttp-之前的时代"><a href="#OkHttp-之前的时代" class="headerlink" title="OkHttp 之前的时代"></a>OkHttp 之前的时代</h1><br/>

<p>在讲述OkHttp之前, 我们看下没有OkHttp的时代, 我们是如何完成http请求的.</p>
<p>在没有OkHttp的日子, 我们使用</p>
<ul>
<li>HttpURLConnection</li>
<li>HttpClient</li>
</ul>
<p>那么这两者都有什么优缺点呢? 为什么不在继续使用下去呢?</p>
<p><code>HttpClient</code>是Apache基金会的一个开源网络库, 功能十分强大, API数量众多, 但是正是由于庞大的API数量使得我们很难在不破坏兼容性的情况下对它进行升级和扩展, 所以Android团队在提升和优化HttpClient方面的工作态度并不积极.</p>
<p><code>HttpURLConnection</code>是一种多用途, 轻量极的HTTP客户端, 提供的API比较简单, 可以容易地去使用和扩展. 不过在Android 2.2版本之前, <code>HttpURLConnection</code>一直存在着一些令人厌烦的bug. 比如说对一个可读的<code>InputStream</code>调用<code>close()</code>方法时，就有可能会导致连接池失效了。</p>
<br/>

<h1 id="OkHttp"><a href="#OkHttp" class="headerlink" title="OkHttp"></a>OkHttp</h1><br/>

<p>优点在这里不说了，网上一大堆。</p>
<p><a href="https://square.github.io/okhttp/">官方文档</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>使用 <code>gradle</code></p>
<pre><code>implementation(&quot;com.squareup.okhttp3:okhttp:版本号&quot;)</code></pre><h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><ul>
<li><a href="https://www.vergil.com.cn/129.html">参考资料</a></li>
</ul>
<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><p>基本使用步骤如下</p>
<ul>
<li>构建客户端对象<code>OkHttpClient</code></li>
<li>构建请求<code>Request</code></li>
<li>生成<code>Call</code>对象</li>
<li><code>Call</code>发起请求（同步/异步）</li>
</ul>
<h3 id="GET-请求"><a href="#GET-请求" class="headerlink" title="GET 请求"></a>GET 请求</h3><p>以百度主页为例，进行Get请求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient httpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line">String url = <span class="string">"https://www.baidu.com/"</span>;</span><br><span class="line">Request getRequest = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">        .url(url)</span><br><span class="line">        .get()</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">Call call = httpClient.newCall(getRequest);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//同步请求，要放到子线程执行</span></span><br><span class="line">            Response response = call.execute();</span><br><span class="line">            Log.i(TAG, <span class="string">"okHttpGet run: response:"</span>+ response.body().string());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure>

<p>首先，创建了<code>OkHttpClient</code>实例，接着用<code>Request.Builder</code>构建了<code>Request</code>实例并传入了百度主页的<code>url</code>，然后<code>httpClient.newCall</code>方法传入<code>Request</code>实例生成<code>call</code>，最后在子线程调用<code>call.execute()</code>执行请求获得结果<code>response</code>。</p>
<p>所以，使用<code>OkHttp</code>进行<code>get</code>请求，是比较简单的，只要在构建<code>Request</code>实例时更换<code>url</code>就可以了。</p>
<h4 id="异步请求"><a href="#异步请求" class="headerlink" title="异步请求"></a>异步请求</h4><p>有个问题，你可能注意到了，这里是放在子线程执行请求的，这是因为<code>call.execute()</code>是同步方法。想要在主线程直接使用而不用手动创建子线程可以嘛？当然可以，使用<code>call.enqueue(callback)</code>即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">call.enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">"okHttpGet enqueue: onResponse:"</span>+ response.body().string());</span><br><span class="line"></span><br><span class="line">        ResponseBody body = response.body();</span><br><span class="line">        String string = body.string();</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = body.bytes();</span><br><span class="line">        InputStream inputStream = body.byteStream();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>call.enqueue</code>会异步执行，需要注意的是，两个回调方法<code>onFailure</code>、<code>onResponse</code>是执行在子线程的，所以如果想要执行UI操作，需要使用Handler切换到UI线程。</p>
<p>同步的情况下，也可以是主线程中运行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> okhttp3.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        OkHttpClient httpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">        String url = <span class="string">"https://www.baidu.com/"</span>;</span><br><span class="line">        Request getRequest = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .get()</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        Call call = httpClient.newCall(getRequest);</span><br><span class="line">        Response response = call.execute();</span><br><span class="line">        System.out.println(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="取消请求"><a href="#取消请求" class="headerlink" title="取消请求"></a>取消请求</h4><p>每一个<code>Call</code>只能执行一次（原因会在下篇流程分析中说明）。 如果想要取消正在执行的请求，可以使用<code>call.cancel()</code>，通常在离开页面时都要取消执行的请求的。</p>
<h4 id="结果处理"><a href="#结果处理" class="headerlink" title="结果处理"></a>结果处理</h4><p>请求回调的两个方法是指 传输层 的失败和成功。<code>onFailure</code>通常是<code>connection</code>连接失败或读写超时；<code>onResponse</code>是指，成功的从服务器获取到了结果，但是这个结果的响应码可能是404、500等，也可能就是200（<code>response.code()</code>的取值）。</p>
<p>如果<code>response.code()</code>是<code>200</code>，表示应用层请求成功了。此时我们可以获取<code>Response</code>的<code>ResponseBody</code>，这是<code>响应体</code>。从面看到，可以从<code>ResponseBody</code>获取<code>string</code>、<code>byte[]</code>、<code>InputStream</code>，这样就可以对结果进行很多操作了，比如<code>UI</code>上展示<code>string</code>（要用<code>Handler</code>切换到UI线程）、通过<code>InputStream</code>写入文件等等。</p>
<p>上面异步请求执行后 结果打印如下：</p>
<pre><code>2020-05-04 21:52:56.446 32681-3631/com.hfy.androidlearning I/OkHttpTestActivity: okHttpGet run: response:&lt;!DOCTYPE html&gt;
&lt;!--STATUS OK--&gt;&lt;html&gt; &lt;head&gt;&lt;meta http-equiv=content-type content=text/html;charset=utf-8&gt;&lt;meta http-equiv=X-UA-Compatible content=IE=Edge&gt;&lt;meta content=always name=referrer&gt;&lt;link rel=stylesheet type=text/css href=https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/bdorz/baidu.min.css&gt;&lt;title&gt;百度一下，你就知道&lt;/title&gt;&lt;/head&gt; &lt;body link=#0000cc&gt; &lt;div id=wrapper&gt; &lt;div id=head&gt; &lt;div class=head_wrapper&gt; &lt;div class=s_form&gt; &lt;div class=s_form_wrapper&gt; &lt;div id=lg&gt; &lt;img hidefocus=true src=//www.baidu.com/img/bd_logo1.png width=270 height=129&gt; &lt;/div&gt; &lt;form id=form name=f action=//www.baidu.com/s class=fm&gt; &lt;input type=hidden name=bdorz_come value=1&gt; &lt;input type=hidden name=ie value=utf-8&gt; &lt;input type=hidden name=f value=8&gt; &lt;input type=hidden name=rsv_bp value=1&gt; &lt;input type=hidden name=rsv_idx value=1&gt; &lt;input type=hidden name=tn value=baidu&gt;&lt;span class=&quot;bg s_ipt_wr&quot;&gt;&lt;input id=kw name=wd class=s_ipt value maxlength=255 autocomplete=off autofocus=autofocus&gt;&lt;/span&gt;&lt;span class=&quot;bg s_btn_wr&quot;&gt;&lt;input type=submit id=su value=百度一下 class=&quot;bg s_btn&quot; autofocus&gt;&lt;/span&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;div id=u1&gt; &lt;a href=http://news.baidu.com name=tj_trnews class=mnav&gt;新闻&lt;/a&gt; &lt;a href=https://www.hao123.com name=tj_trhao123 class=mnav&gt;hao123&lt;/a&gt; &lt;a href=http://map.baidu.com name=tj_trmap class=mnav&gt;地图&lt;/a&gt; &lt;a href=http://v.baidu.com name=tj_trvideo class=mnav&gt;视频&lt;/a&gt; &lt;a href=http://tieba.baidu.com name=tj_trtieba class=mnav&gt;贴吧&lt;/a&gt; &lt;noscript&gt; &lt;a href=http://www.baidu.com/bdorz/login.gif?login&amp;amp;tpl=mn&amp;amp;u=http%3A%2F%2Fwww.baidu.com%2f%3fbdorz_come%3d1 name=tj_login class=lb&gt;登录&lt;/a&gt; &lt;/noscript&gt; &lt;script&gt;document.write(&apos;&lt;a href=&quot;http://www.baidu.com/bdorz/login.gif?login&amp;tpl=mn&amp;u=&apos;+ encodeURIComponent(window.location.href+ (window.location.search === &quot;&quot; ? &quot;?&quot; : &quot;&amp;&quot;)+ &quot;bdorz_come=1&quot;)+ &apos;&quot; name=&quot;tj_login&quot; class=&quot;lb&quot;&gt;登录&lt;/a&gt;&apos;);
&lt;/script&gt; &lt;a href=//www.baidu.com/more/ name=tj_briicon class=bri style=&quot;display: block;&quot;&gt;更多产品&lt;/a&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div id=ftCon&gt; &lt;div id=ftConw&gt; &lt;p id=lh&gt; &lt;a href=http://home.baidu.com&gt;关于百度&lt;/a&gt; &lt;a href=http://ir.baidu.com&gt;About Baidu&lt;/a&gt; &lt;/p&gt; &lt;p id=cp&gt;&amp;copy;2017&amp;nbsp;Baidu&amp;nbsp;&lt;a href=http://www.baidu.com/duty/&gt;使用百度前必读&lt;/a&gt;&amp;nbsp; &lt;a href=http://jianyi.baidu.com/ class=cp-feedback&gt;意见反馈&lt;/a&gt;&amp;nbsp;京ICP证030173号&amp;nbsp; &lt;img src=//www.baidu.com/img/gs.gif&gt; &lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt;</code></pre><p>可见百度首页的get请求成功响应了。</p>
<h3 id="POST-请求"><a href="#POST-请求" class="headerlink" title="POST 请求"></a>POST 请求</h3><h4 id="post请求提交String、文件"><a href="#post请求提交String、文件" class="headerlink" title="post请求提交String、文件"></a>post请求提交String、文件</h4><p><code>post</code>请求与<code>get</code>请求的区别 是在构造<code>Request</code>对象时，需要多构造一个<code>RequestBody</code>对象，用它来携带我们要提交的数据，其他都是一样的。示例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient httpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line">MediaType contentType = MediaType.parse(<span class="string">"text/x-markdown; charset=utf-8"</span>);</span><br><span class="line">String content = <span class="string">"hello!"</span>;</span><br><span class="line">RequestBody body = RequestBody.create(contentType, content);</span><br><span class="line"></span><br><span class="line">Request getRequest = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">        .url(<span class="string">"https://api.github.com/markdown/raw"</span>)</span><br><span class="line">        .post(body)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">Call call = httpClient.newCall(getRequest);</span><br><span class="line"></span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">"okHttpPost enqueue: \n onResponse:"</span>+ response.toString() +<span class="string">"\n body:"</span> +response.body().string());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>对比<code>get</code>请求，把构建<code>Request</code>时的<code>get()</code>改成<code>post(body)</code>，并传入<code>RequestBody</code>实例。<code>RequestBody</code>实例是通过<code>create</code>方法创建，需要指定请求体内容类型、请求体内容。这里是传入了一个指定为<code>markdown</code>格式的文本。</p>
<p>结果打印如下：</p>
<pre><code>2020-05-05 13:18:26.445 13301-13542/com.hfy.androidlearning I/OkHttpTestActivity: okHttpPost enqueue: 
 onResponse:Response{protocol=http/1.1, code=200, message=OK, url=https://api.github.com/markdown/raw}
 body:&lt;p&gt;hello!&lt;/p&gt;</code></pre><p>请求成功并把请求体内容又返回来了。</p>
<p>传入<code>RequestBody</code>的 <code>MediaType</code> 还可以是其他类型，如客户端要给后台发送<code>json字符串</code>、发送一张<code>图片</code>，那么可以定义为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RequestBody:jsonBody，json字符串</span></span><br><span class="line">String json = <span class="string">"jsonString"</span>;</span><br><span class="line">RequestBody jsonBody = RequestBody.create(MediaType.parse(<span class="string">"application/json; charset=utf-8"</span>), json);</span><br><span class="line"></span><br><span class="line"><span class="comment">//RequestBody:fileBody, 上传文件</span></span><br><span class="line">File file = <span class="keyword">new</span> File(Environment.getExternalStorageDirectory(), <span class="string">"1.png"</span>);</span><br><span class="line">RequestBody fileBody = RequestBody.create(MediaType.parse(<span class="string">"image/png"</span>), file);</span><br></pre></td></tr></table></figure>

<p>MediaType更多类型信息可以查看 <a href="https://www.vergil.com.cn/go/aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzIwNDU=">RFC 2045</a>。</p>
<h4 id="post请求提交表单"><a href="#post请求提交表单" class="headerlink" title="post请求提交表单"></a>post请求提交表单</h4><p>构建<code>RequestBody</code>除了上面的方式，还有它的子类<code>FormBody</code>，<code>FormBody</code>用于提交表单键值对，这种能满足平常开发大部分的需求。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RequestBody:FormBody，表单键值对</span></span><br><span class="line">RequestBody formBody = <span class="keyword">new</span> FormBody.Builder()</span><br><span class="line">        .add(<span class="string">"username"</span>, <span class="string">"hfy"</span>)</span><br><span class="line">        .add(<span class="string">"password"</span>, <span class="string">"qaz"</span>)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>

<p><code>FormBody</code>是通过<code>FormBody.Builder</code>用构建者模式创建，<code>add</code>键值对即可。它的<code>contentType</code>在内部已经指定了。</p>
<pre><code>private static final MediaType CONTENT_TYPE = MediaType.get(&quot;application/x-www-form-urlencoded&quot;);</code></pre><h4 id="post请求提交复杂请求体"><a href="#post请求提交复杂请求体" class="headerlink" title="post请求提交复杂请求体"></a>post请求提交复杂请求体</h4><p><code>RequestBody</code>另一个子类<code>MultipartBody</code>，用于<code>post</code>请求提交复杂类型的请求体。复杂请求体可以同时包含多种类型的的请求体数据。</p>
<p>上面介绍的 post请求 string、文件、表单，只有单一类型。考虑一种场景–注册场景，用户填写完姓名、电话，同时要上传头像图片，这时注册接口的请求体就需要 接受 表单键值对 以及文件了，那么前面讲的的post就无法满足了。那么就要用到<code>MultipartBody</code>了。 完整代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient httpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line"><span class="comment">//MediaType contentType = MediaType.parse("text/x-markdown; charset=utf-8");</span></span><br><span class="line"><span class="comment">//String content = "hello!";</span></span><br><span class="line"><span class="comment">//RequestBody body = RequestBody.create(contentType, content);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//RequestBody:fileBody,上传文件</span></span><br><span class="line">File file = drawableToFile(<span class="keyword">this</span>, R.mipmap.bigpic, <span class="keyword">new</span> File(<span class="string">"00.jpg"</span>));</span><br><span class="line">RequestBody fileBody = RequestBody.create(MediaType.parse(<span class="string">"image/jpg"</span>), file);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//RequestBody:multipartBody, 多类型 （用户名、密码、头像）</span></span><br><span class="line">MultipartBody multipartBody = <span class="keyword">new</span> MultipartBody.Builder()</span><br><span class="line">        .setType(MultipartBody.FORM)</span><br><span class="line">        .addFormDataPart(<span class="string">"username"</span>, <span class="string">"hufeiyang"</span>)</span><br><span class="line">        .addFormDataPart(<span class="string">"phone"</span>, <span class="string">"123456"</span>)</span><br><span class="line">        .addFormDataPart(<span class="string">"touxiang"</span>, <span class="string">"00.png"</span>, fileBody)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Request getRequest = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">        .url(<span class="string">"http://yun918.cn/study/public/file_upload.php"</span>)</span><br><span class="line">        .post(multipartBody)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">Call call = httpClient.newCall(getRequest);</span><br><span class="line"></span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">"okHttpPost enqueue: \n onFailure:"</span>+ call.request().toString() +<span class="string">"\n body:"</span> +call.request().body().contentType()</span><br><span class="line">        +<span class="string">"\n IOException:"</span>+e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">"okHttpPost enqueue: \n onResponse:"</span>+ response.toString() +<span class="string">"\n body:"</span> +response.body().string());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>可见，在构建<code>RequestBody</code>时是使用<code>MultipartBody.Builder</code>构建了<code>MultipartBody</code>实例，通过<code>addFormDataPart</code>方法传入了姓名、电话的键值对，也通过<code>addFormDataPart(“touxiang”, “00.png”, fileBody)</code>传入了头像图片，其中<code>&quot;touxiang&quot;</code>是<code>key值</code>， <code>&quot;00.png&quot;</code>是文件名，<code>fileBody</code>是要以上传的图片创建的<code>RequestBody</code>。</p>
<p>因为所有数据都是以键值对的表单形式提交，所以要设置<code>setType(MultipartBody.FORM)</code>。</p>
<blockquote>
<p>其他请求方式像<code>put</code>、<code>header</code>、<code>delete</code>，主要在构建<code>Request</code>时把<code>get()</code>或<code>post()</code>换成<code>put()</code>、<code>header()</code>、<code>delete()</code>就可以了，但一般在Android端很少用到。</p>
</blockquote>
<h3 id="请求配置项"><a href="#请求配置项" class="headerlink" title="请求配置项"></a>请求配置项</h3><p>先看几个问题：</p>
<ul>
<li>如何全局设置超时时长?</li>
<li>缓存位置、最大缓存大小 呢？</li>
<li>考虑有这样一个需求，我要监控<code>App</code>通过 <code>OkHttp</code> 发出的 所有 原始请求，以及整个请求所耗费的时间，如何做？</li>
</ul>
<p>这些问题，在<code>OkHttp</code>这里很简单。把<code>OkHttpClient</code>实例的创建，换成以下方式即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">        .connectTimeout(<span class="number">15</span>, TimeUnit.SECONDS)</span><br><span class="line">        .readTimeout(<span class="number">10</span>, TimeUnit.SECONDS)</span><br><span class="line">        .writeTimeout(<span class="number">10</span>, TimeUnit.SECONDS)</span><br><span class="line">        .cache(<span class="keyword">new</span> Cache(getExternalCacheDir(),<span class="number">500</span> * <span class="number">1024</span> * <span class="number">1024</span>))</span><br><span class="line">        .addInterceptor(<span class="keyword">new</span> Interceptor() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                Request request = chain.request();</span><br><span class="line">                String url = request.url().toString();</span><br><span class="line">                Log.i(TAG, <span class="string">"intercept: proceed start: url"</span>+ url+ <span class="string">", at "</span>+System.currentTimeMillis());</span><br><span class="line">                Response response = chain.proceed(request);</span><br><span class="line">                ResponseBody body = response.body();</span><br><span class="line">                Log.i(TAG, <span class="string">"intercept: proceed end: url"</span>+ url+ <span class="string">", at "</span>+System.currentTimeMillis());</span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>

<p>这里通过<code>OkHttpClient.Builder</code>通过构建者模式设置了连接、读取、写入的超时时长，用<code>cache()</code>方法传入了由缓存目录、缓存大小构成的<code>Cache实例</code>，这样就解决了前两个问题。</p>
<p>还注意到，使用<code>addInterceptor()</code>方法添加了<code>Interceptor实例</code>，且重写了<code>intercept方法</code>。<code>Interceptor</code>意为拦截器，<code>intercept()</code>方法会在开始执行请求时调用。其中<code>chain.proceed(request)</code>内部是真正请求的过程，是阻塞操作，执行完后会就会得到请求结果<code>ResponseBody</code>，所以<code>chain.proceed(request)</code>的前后取当前时间，那么就知道整个请求所耗费的时间。上面<code>chain.proceed(request)</code>的前后分别打印的日志和时间，这样第三个问题也解决了。</p>
<h4 id="一个可运行的拦截器"><a href="#一个可运行的拦截器" class="headerlink" title="一个可运行的拦截器"></a>一个可运行的拦截器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.star;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> okhttp3.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">                .connectTimeout(<span class="number">15</span>, TimeUnit.SECONDS)</span><br><span class="line">                .readTimeout(<span class="number">10</span>, TimeUnit.SECONDS)</span><br><span class="line">                .writeTimeout(<span class="number">10</span>, TimeUnit.SECONDS)</span><br><span class="line">                .addInterceptor(<span class="keyword">new</span> Interceptor() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                        Request request = chain.request();</span><br><span class="line">                        String url = request.url().toString();</span><br><span class="line">                        Response response = chain.proceed(request);</span><br><span class="line">                        ResponseBody body = response.body();</span><br><span class="line">                        <span class="keyword">return</span> response;   <span class="comment">// 断点 1</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        String url = <span class="string">"https://www.baidu.com/"</span>; <span class="comment">// 断点 2</span></span><br><span class="line">        Request getRequest = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .get()</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        Call call = client.newCall(getRequest);</span><br><span class="line">        Response response = call.execute();</span><br><span class="line">        System.out.println(response);  <span class="comment">// 断点 3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里面有三个端点，如果经过 <code>debug</code> 的话，其顺序是这样的</p>
<pre><code>断点 2 -&gt; 断点 1 -&gt; 断点 3</code></pre><blockquote>
<p>通常<code>OkHttpClient</code>实例是全局唯一的，这样这些基本配置就是统一，且内部维护的连接池也可以有效复用</p>
</blockquote>
<p>全局配置的有了，单个请求的也可以有一些单独的配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Request getRequest = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">        .url(<span class="string">"http://yun918.cn/study/public/file_upload.php"</span>)</span><br><span class="line">        .post(multipartBody)</span><br><span class="line">        .addHeader(<span class="string">"key"</span>,<span class="string">"value"</span>)</span><br><span class="line">        .cacheControl(CacheControl.FORCE_NETWORK)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>

<p>这个<code>Request</code>实例.</p>
<ul>
<li>使用<code>addHeader()</code>方法添加了请求头。</li>
<li>使用<code>cacheControl(CacheControl.FORCE_NETWORK)</code>设置此次请求是能使用网络，不用缓存。（还可以设置只用缓存<code>FORCE_CACHE</code>。）</li>
</ul>
<p>好了，okhttp的使用就讲这里了，总体还是比较简单的。</p>

    </div>

    
    
    
        <div class="reward-container">
  <div>请我喝杯咖啡吧～</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/icon/wechat.jpeg" alt="犀牛 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/icon/aipay.jpeg" alt="犀牛 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/OkHttp/" rel="tag"># OkHttp</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/07/15/java4/" rel="prev" title="java | Guava">
      <i class="fa fa-chevron-left"></i> java | Guava
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/07/17/java6/" rel="next" title="lombok | 简介和使用">
      lombok | 简介和使用 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#OkHttp-之前的时代"><span class="nav-number">1.</span> <span class="nav-text">OkHttp 之前的时代</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OkHttp"><span class="nav-number">2.</span> <span class="nav-text">OkHttp</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装"><span class="nav-number">2.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#快速入门"><span class="nav-number">2.2.</span> <span class="nav-text">快速入门</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用方式"><span class="nav-number">2.3.</span> <span class="nav-text">使用方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#GET-请求"><span class="nav-number">2.3.1.</span> <span class="nav-text">GET 请求</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#异步请求"><span class="nav-number">2.3.1.1.</span> <span class="nav-text">异步请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#取消请求"><span class="nav-number">2.3.1.2.</span> <span class="nav-text">取消请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#结果处理"><span class="nav-number">2.3.1.3.</span> <span class="nav-text">结果处理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#POST-请求"><span class="nav-number">2.3.2.</span> <span class="nav-text">POST 请求</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#post请求提交String、文件"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">post请求提交String、文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#post请求提交表单"><span class="nav-number">2.3.2.2.</span> <span class="nav-text">post请求提交表单</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#post请求提交复杂请求体"><span class="nav-number">2.3.2.3.</span> <span class="nav-text">post请求提交复杂请求体</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#请求配置项"><span class="nav-number">2.3.3.</span> <span class="nav-text">请求配置项</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一个可运行的拦截器"><span class="nav-number">2.3.3.1.</span> <span class="nav-text">一个可运行的拦截器</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="犀牛"
      src="/images/icon/icon.png">
  <p class="site-author-name" itemprop="name">犀牛</p>
  <div class="site-description" itemprop="description">求职web3工作，欢迎联系 xiniublog@163.com</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">2141</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1153</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">627</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:xiniublog@163.com" title="E-Mail → mailto:xiniublog@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">犀牛</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.7.2
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'E96BxDaGNGpHB8Fp5JadyD1A-MdYXbMMI',
      appKey     : 'Hp34boCFr2uY72f9aj2V2jgn',
      placeholder: "由于 leancloud 限制，评论只允许海外IP访问。如果你无法通过留言询问问题，请发送邮件到 xiniublog@163.com 。另外，提问问题请遵守 https://benpaodewoniu.github.io/problem/ 。如果你真的想要我联系你或者想交个朋友，请通过邮箱联系我，告知我你的微信号。在评论里留下邮箱，处于岁月静好的原则，我是不会加也不会去打扰的。",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : 'https://e96bxdag.api.lncldglobal.com'
    });
  }, window.Valine);
});
</script>

</body>
</html>
